RUSTFLAGS       := "-Awarnings -Dunused_must_use"
DEBUG_RUSTFLAGS := "-Awarnings -Dunused_must_use -C debuginfo=2"
CARGO           := MAKEFLAGS= env CARGO_BUILD_JOBS=12 NUM_JOBS=12 cargo

ACTIVE_TEST := xxx

ACTIVE_BINARY  := pry
ACTIVE_PACKAGE := pry

RUST_LOG       := info
RUST_BACKTRACE := full 

DOCUMENT_PATH := test-doc.pdf

DEFAULT := run

default: $(DEFAULT)

all: 
	RUST_LOG=$(RUST_LOG) RUSTFLAGS=$(RUSTFLAGS) $(CARGO) build 

build:
	RUST_LOG=$(RUST_LOG) RUSTFLAGS=$(RUSTFLAGS) $(CARGO) build -p $(ACTIVE_PACKAGE)

build_test:
	RUST_LOG=$(RUST_LOG) RUSTFLAGS=$(DEBUG_RUSTFLAGS) $(CARGO) test --no-run -p $(ACTIVE_PACKAGE) $(ACTIVE_TEST)

test:
	RUST_LOG=$(RUST_LOG) RUSTFLAGS=$(RUSTFLAGS) $(CARGO) test -p $(ACTIVE_PACKAGE) $(ACTIVE_TEST) -- --nocapture

tests:
	RUST_TEST_THREADS=1 RUST_BACKTRACE=$(RUST_BACKTRACE) RUST_LOG=$(RUST_LOG) RUSTFLAGS=$(RUSTFLAGS) $(CARGO) test -p $(ACTIVE_PACKAGE) -- --nocapture

all_tests:
	RUST_TEST_THREADS=1 RUST_BACKTRACE=$(RUST_BACKTRACE) RUST_LOG=$(RUST_LOG) RUSTFLAGS=$(RUSTFLAGS) $(CARGO) test -- --nocapture

run:
	DOCUMENT_PATH=$(DOCUMENT_PATH) RUST_BACKTRACE=1 RUST_LOG=$(RUST_LOG) RUSTFLAGS=$(RUSTFLAGS) $(CARGO) run -p $(ACTIVE_PACKAGE) -- $(ACTIVE_BINARY)
